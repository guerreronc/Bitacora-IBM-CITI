{% extends "base.html" %}
{% block content %}
    <meta charset="UTF-8">
    <title>Editar Servidor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<div class="container">

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="alert alert-{{ 'success' if category=='success' else 'warning' }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="card shadow">
        <div class="card-header bg-warning">
            <strong>Editar Servidor</strong>
        </div>

        <div class="card-body">

            <form method="POST" action="/base-servidores/editar/{{ servidor.serie }}?localidad={{ current_localidad }}">

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Serie</label>
                        <input class="form-control" value="{{ servidor.serie }}" readonly>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Hostname</label>
                        <input class="form-control" value="{{ servidor.hostname }}" readonly>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Ubicación</label>
                        <input name="ubicacion" class="form-control" value="{{ servidor.ubicacion }}">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Garantía</label>
                        <input type="date" name="garantia" class="form-control"
                               value="{{ servidor.garantia }}">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Estatus</label>
                    <select name="estatus" class="form-select">
                        {% for e in ["ACTIVO","BAJA","DECOMISADO"] %}
                            <option value="{{ e }}" {% if servidor.estatus == e %}selected{% endif %}>
                                {{ e }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="submit" class="btn btn-success">
                        Guardar cambios
                    </button>

                    <button type="button"
                            class="btn btn-danger"
                            onclick="confirmarEliminacion()">
                        Eliminar servidor
                    </button>
                </div>

            </form>

            <!-- Formulario oculto para eliminar -->
            <form id="formEliminar" method="POST" action="{{ url_for('base_servidores.eliminar_servidor', serie=servidor.serie) }}">
                <input type="hidden" name="localidad" value="{{ current_localidad }}">
            </form>


            <script>
            function confirmarEliminacion() {
                if (confirm("⚠️ Esta acción eliminará PERMANENTEMENTE el servidor.\n¿Desea continuar?")) {
                    document.getElementById("formEliminar").submit();
                }
            }
            </script>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}